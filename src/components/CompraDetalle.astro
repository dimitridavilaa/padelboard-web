---
// src/components/CompraDetalle.astro
---

<section class="compra-section">
    <div class="container">
        
        <div class="card product-card fade-up">
            
            <div class="product-info">
                <h1>MARCADOR PADELBOARD</h1>
                
                <p class="description">
                    Con PadelBoard est√°s comprando un marcador digital profesional (al√°mbrico), 
                    listo para usar y pensado para que juegues como en un torneo, 
                    sin discusiones y con total claridad del puntaje. Que incluye:
                </p>

                <ul class="feature-list">
                    <li><span class="bullet"></span> Pantalla HD 42‚Äù</li>
                    <li><span class="bullet"></span> 2 Sensores PadelBoard con pedestal</li>
                    <li><span class="bullet"></span> Soporte universal de pantalla</li>
                    <li><span class="bullet"></span> Kit de montaje / sistema al√°mbrico</li>
                </ul>

                <p class="disclaimer">*Por la compra de 3 o m√°s marcadores PadelBoard obt√©n un precio de $899.00 USD c/u*</p>

                <div class="price-block">
                    <span class="price" id="price-display">$999.00 USD</span>
                    <span class="tax">NO INCLUYE IVA</span>
                </div>

                <div class="actions-row">
                    <div class="qty-selector">
                        <button id="btn-minus" type="button">-</button>
                        <input type="number" id="qty-input" value="1" min="1" max="99" />
                        <button id="btn-plus" type="button">+</button>
                    </div>
                    
                    <button class="btn btn-primary" id="btn-add">AGREGAR AL CARRITO</button>
                </div>
                
                <button class="btn btn-full-width" id="btn-pay">PAGAR AHORA</button>
            </div>

            <div class="product-gallery">
                <div class="img-main">
                    <img src="/img/formulario.jpg" alt="Pantalla Padel Board" />
                </div>
                <div class="img-grid-bottom">
                    <img src="/img/sensor.jpg" alt="Sensor detalle" />
                    <img src="/img/paso2_app.jpg" alt="App en mano" />
                </div>
            </div>
        </div>

        <div class="card plan-card fade-up">
            
            <div class="plan-header">
                <div class="plan-title">
                    <h2>PLAN MENSUAL <br> PADELBOARD</h2>
                </div>
                <div class="plan-desc">
                    El Plan Mensual PadelBoard es un servicio requerido que asegura el funcionamiento √≥ptimo de tu marcador inteligente y mantiene activa la garant√≠a del equipo. Este plan garantiza que tu PadelBoard opere siempre con la mejor experiencia, estabilidad y personalizaci√≥n posible.
                </div>
                <div class="plan-price-tag">
                    $25.00/Mes
                </div>
            </div>

            <div class="plan-features">
                <div class="feature-row">
                    <div class="feature-name">
                        <span class="bullet"></span> 
                        <strong>Mantenimiento del sistema y garant√≠a activa</strong>
                    </div>
                    <div class="feature-text">
                        Revisi√≥n continua del funcionamiento interno, prevenci√≥n de fallas y optimizaci√≥n del rendimiento del marcador. La garant√≠a del hardware se mantiene vigente mientras el plan est√© activo, asegurando respaldo ante cualquier inconveniente t√©cnico.
                    </div>
                </div>
                <hr>
                <div class="feature-row">
                    <div class="feature-name">
                        <span class="bullet"></span> 
                        <strong>Acceso completo a la App Web</strong>
                    </div>
                    <div class="feature-text">
                        Configura tus partidos escaneando el c√≥digo QR: nombres de jugadores, tipo de partido, punto de oro o ventaja, cambio de lado, entre otras opciones avanzadas.
                    </div>
                </div>
                <hr>
                <div class="feature-row">
                    <div class="feature-name">
                        <span class="bullet"></span> 
                        <strong>Actualizaciones constantes y Soporte t√©cnico en l√≠nea</strong>
                    </div>
                    <div class="feature-text">
                        Mejoras peri√≥dicas en el sistema, nuevas funciones, mayor estabilidad y experiencia de uso actualizada. atenci√≥n remota r√°pida para resolver dudas, problemas o asistencia en configuraci√≥n.
                    </div>
                </div>
                 <hr>
                <div class="feature-row">
                    <div class="feature-name">
                        <span class="bullet"></span> 
                        <strong>Eliminaci√≥n de publicidad y Personalizaci√≥n del marcador</strong>
                    </div>
                    <div class="feature-text">
                        Tu marcador funcionar√° sin anuncios, ofreciendo una experiencia m√°s profesional y limpia. Configuraci√≥n con el nombre y los colores oficiales de tu club, reforzando la identidad visual y profesionalizaci√≥n del espacio deportivo.
                    </div>
                </div>
            </div>

        </div>

    </div>

    <div id="checkout-modal" class="modal-overlay hidden">
        <div class="modal-content fade-up">
            <button id="close-modal" class="close-btn">&times;</button>
            
            <div class="modal-header">
                <h3>RESUMEN DE TU PEDIDO</h3>
                <p>Confirma los detalles antes de contactar a un asesor.</p>
            </div>
    
            <div class="order-summary">
                <div class="summary-row">
                    <span>Producto:</span>
                    <strong>Marcador PadelBoard</strong>
                </div>
                <div class="summary-row">
                    <span>Cantidad:</span>
                    <strong id="modal-qty">1</strong>
                </div>
                <div class="summary-row total">
                    <span>Total Estimado:</span>
                    <strong id="modal-total">$999.00 USD</strong>
                </div>
            </div>
    
            <form id="checkout-form" class="checkout-form">
                <label>Tu Nombre Completo</label>
                <input type="text" id="client-name" placeholder="Ej. Juan P√©rez" required>
                
                <label>Nombre de tu Club / Empresa</label>
                <input type="text" id="client-company" placeholder="Ej. Padel Center" required>
    
                <button type="submit" class="btn-confirm">
                    CONFIRMAR Y SOLICITAR EN WHATSAPP
                    <img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg" width="20" style="margin-left:8px">
                </button>
            </form>
            
            <p class="secure-note">üîí Tus datos se enviar√°n encriptados al chat de ventas.</p>
        </div>
    </div> 593987225485

</section>

<script>
    // 1. CONFIGURACI√ìN
    const WHATSAPP_NUMBER = "593987225485"; // TU N√öMERO
    const PRICE_BASE = 999;
    const PRICE_DISCOUNT = 899;

    // 2. ELEMENTOS (Usamos "as HTMLElement" para evitar errores de null)
    const minusBtn = document.getElementById('btn-minus');
    const plusBtn = document.getElementById('btn-plus');
    const input = document.getElementById('qty-input') as HTMLInputElement;
    const priceDisplay = document.getElementById('price-display');
    const btnPay = document.getElementById('btn-pay');
    const btnAdd = document.getElementById('btn-add');

    // Elementos del Modal
    const modal = document.getElementById('checkout-modal') as HTMLElement;
    const closeModal = document.getElementById('close-modal');
    const modalQty = document.getElementById('modal-qty');
    const modalTotal = document.getElementById('modal-total');
    const checkoutForm = document.getElementById('checkout-form');
    const clientName = document.getElementById('client-name') as HTMLInputElement;
    const clientCompany = document.getElementById('client-company') as HTMLInputElement;

    // 3. CALCULAR PRECIOS
    function getPriceData() {
        let qty = parseInt(input.value) || 1;
        let unitPrice = (qty >= 3) ? PRICE_DISCOUNT : PRICE_BASE;
        let total = unitPrice * qty;
        return { qty, unitPrice, total };
    }

    function updatePriceDisplay() {
        if (!input || !priceDisplay) return;
        const { unitPrice } = getPriceData();
        priceDisplay.innerText = `$${unitPrice}.00 USD`;
    }

    // 4. ABRIR MODAL (Agregamos el tipo ": Event" aqu√≠)
    function openModal(e: Event) {
        e.preventDefault(); 
        const { qty, total } = getPriceData();
        
        // Actualizamos los datos dentro del modal
        if(modalQty) modalQty.innerText = qty.toString();
        if(modalTotal) modalTotal.innerText = `$${total}.00 USD`;
        
        // Mostramos el modal (TypeScript ya sabe que 'modal' existe gracias al "as HTMLElement")
        modal.classList.remove('hidden');
    }

    // 5. ENVIAR A WHATSAPP (Agregamos el tipo ": Event" aqu√≠)
    function sendToWhatsapp(e: Event) {
        e.preventDefault(); 
        
        const { qty, unitPrice, total } = getPriceData();
        const name = clientName ? clientName.value : "";
        const company = clientCompany ? clientCompany.value : "";

        if(!name || !company) {
            alert("Por favor completa tu nombre y empresa");
            return;
        }

        let rawMessage = `*NUEVO PEDIDO WEB - PADEL BOARD* üöÄ\n\n` +
                      `üë§ *Cliente:* ${name}\n` +
                      `üè¢ *Club/Empresa:* ${company}\n\n` +
                      `üìù *DETALLE DEL PEDIDO:*\n` +
                      `--------------------------------\n` +
                      `üéæ Producto: Marcador PadelBoard\n` +
                      `üî¢ Cantidad: ${qty}\n` +
                      `üí≤ Precio Unitario: $${unitPrice}\n` +
                      `üí∞ *TOTAL A PAGAR: $${total} USD*\n` +
                      `--------------------------------\n` +
                      `üìÖ Plan Mensual: $25.00/mes\n\n` +
                      `Quedo a la espera de los datos bancarios para realizar el pago.`;

        let encodedMessage = encodeURIComponent(rawMessage);
        window.open(`https://wa.me/${WHATSAPP_NUMBER}?text=${encodedMessage}`, '_blank');
        
        if(modal) modal.classList.add('hidden');
    }

    // 6. EVENT LISTENERS
    if(minusBtn && plusBtn && input) {
        plusBtn.addEventListener('click', () => {
            let val = parseInt(input.value) || 0;
            input.value = (val + 1).toString();
            updatePriceDisplay();
        });

        minusBtn.addEventListener('click', () => {
            let val = parseInt(input.value) || 0;
            if (val > 1) {
                input.value = (val - 1).toString();
                updatePriceDisplay();
            }
        });

        input.addEventListener('change', () => {
            let val = parseInt(input.value) || 1;
            if (val < 1) input.value = "1";
            updatePriceDisplay();
        });
        
        // Botones principales abren el modal
        if (btnPay) btnPay.addEventListener('click', openModal);
        if (btnAdd) btnAdd.addEventListener('click', openModal);

        // Acciones del Modal
        if (closeModal) closeModal.addEventListener('click', () => modal.classList.add('hidden'));
        if (checkoutForm) checkoutForm.addEventListener('submit', sendToWhatsapp);
        
        // Cerrar si clic afuera
        if (modal) {
            modal.addEventListener('click', (e: Event) => {
                if (e.target === modal) modal.classList.add('hidden');
            });
        }
    }
    
    // Inicializar
    updatePriceDisplay();
</script>

<style>
    /* --- ESTRUCTURA PRINCIPAL --- */
    .compra-section {
        padding: 40px 20px;
        background: var(--gradiente-padel);
        font-family: var(--fuente-cuerpo);
    }

    .container {
        max-width: 1100px;
        margin: 0 auto;
    }

    .card {
        background: white;
        border-radius: 30px;
        padding: 40px;
        margin-bottom: 30px;
        color: #000;
        /* SOLUCI√ìN 1: Esto evita que nada se salga de los bordes redondeados */
        overflow: hidden; 
        box-shadow: 0 10px 30px rgba(0,0,0,0.1); /* Un poco de sombra para profundidad */
    }

    /* --- TARJETA 1: PRODUCTO --- */
    .product-card {
        display: grid;
        /* SOLUCI√ìN 2: Ajustamos las proporciones. 
           1.2fr para texto (m√°s espacio) y 0.8fr para fotos (m√°s controlado) */
        grid-template-columns: 1.2fr 0.8fr; 
        gap: 40px;
        align-items: start; /* Alinea al inicio para que no se estire raro */
    }

    .product-info {
        /* Evita que el texto empuje el ancho m√°s de lo debido */
        min-width: 0; 
    }

    h1 {
        font-family: var(--fuente-titulos);
        font-size: 2.2rem; /* Ajustado levemente para que quepa mejor */
        margin-top: 0;
        margin-bottom: 20px;
        text-transform: uppercase;
        line-height: 1;
        color: #000
    }

    .description {
        font-size: 0.95rem;
        line-height: 1.5;
        margin-bottom: 20px;
        color: #333;
    }

    /* Lista con iconos amarillos */
    .feature-list {
        list-style: none;
        padding: 0;
        margin-bottom: 20px;
    }

    .feature-list li {
        display: flex;
        align-items: center;
        margin-bottom: 10px;
        font-weight: 700;
        font-size: 0.9rem;
    }

    .bullet {
    display: inline-block;
    width: 11px; 
    height: 11px;
    
    /* Usamos la imagen como fondo */
    background-image: url('/img/pelota-padelboard.png'); 
    
    /* Asegura que la pelotita entera quepa dentro del espacio */
    background-size: contain; 
    background-repeat: no-repeat;
    background-position: center;

    margin-right: 10px;
    flex-shrink: 0;
    }

    .disclaimer {
        font-size: 0.75rem;
        font-style: italic;
        color: #666;
        margin-bottom: 20px;
    }

    .price-block {
        margin-bottom: 20px;
    }
    .price {
        display: block;
        font-size: 2.2rem;
        font-weight: 700;
        font-family: var(--fuente-titulos);
    }
    .tax {
        font-size: 0.8rem;
        color: #666;
        font-weight: bold;
    }

    /* Botones y Selectores */
    .actions-row {
        display: flex;
        gap: 10px;
        margin-bottom: 15px;
        flex-wrap: wrap; /* Permite que bajen si no caben */
    }

    /* 1. Selector de Cantidad (La pastilla peque√±a) */
    .qty-selector {
        display: flex;
        align-items: center;
        background-color: var(--color-azul-claro);
        border-radius: 50px;
        padding: 0px 10px; 
        color: white;
        font-weight: bold;
        
        /* CAMBIO: Reducimos ancho m√≠nimo */
        min-width: 110px; 
        
        justify-content: space-between;
        
        /* Opcional: Altura fija para alinearlo perfecto con el bot√≥n de al lado */
        height: 42px; 
    }
    
    /* 2. El n√∫mero dentro del selector */
    #qty-input {
        background: transparent;
        border: none;
        color: white;
        font-family: var(--fuente-titulos);
        font-size: 1.2rem; 
        text-align: center;
        width: 45px;
        outline: none;
    }

    /* Truco CSS para quitar las flechas de n√∫mero nativas del navegador */
    /* Chrome, Safari, Edge, Opera */
    input::-webkit-outer-spin-button,
    input::-webkit-inner-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }
    /* Firefox */
    input[type=number] {
      -moz-appearance: textfield;
    }

    /* 3. Botones + y - */
    .qty-selector button {
        background: none;
        border: none;
        color: white;
        font-size: 1.2rem; 
        cursor: pointer;
        padding: 0 5px;
        transition: transform 0.2s;
        display: flex;       /* Ayuda a centrar el s√≠mbolo verticalmente */
        align-items: center; /* Centrado vertical */
    }
    
    .qty-selector button:hover {
        transform: scale(1.2); /* Efecto al pasar mouse por +/- */
    }

    /* 4. Botones de Acci√≥n (Agregar al Carrito / Pagar Ahora) */
    .btn {
        border: none;
        /* CAMBIO: Reducimos el padding vertical (antes 12px) */
        padding: 0 25px; 
        border-radius: 50px;
        cursor: pointer;
        font-family: var(--fuente-titulos);
        font-size: 1.1rem; 
        letter-spacing: 1.5px;
        transition: transform 0.2s, background-color 0.2s;
        text-transform: uppercase;
        height: 42px; 
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .btn:hover {
        transform: scale(1.02);
        opacity: 0.9;
    }

    .btn-primary {
        background-color: var(--color-azul-claro);
        color: white;
        flex-grow: 1;
        text-align: center;
    }

    .btn-full-width {
        width: 100%;
        background-color: var(--color-azul-claro);
        color: white;
    }

    /* --- GALER√çA DE IM√ÅGENES (FIX CR√çTICO) --- */
    .product-gallery {
        display: flex;
        flex-direction: column;
        gap: 15px;
        /* SOLUCI√ìN 4: Forzamos a que este contenedor nunca sea m√°s ancho que su columna */
        width: 100%;
        min-width: 0; 
    }

    .product-gallery img {
        width: 100%;
        height: 100%;
        object-fit: cover; /* Esto recorta la imagen para llenar el espacio sin deformar */
        border-radius: 20px;
        display: block;
    }

    .img-main {
        /* Altura fija para la imagen grande */
        height: 260px; 
        width: 100%;
    }

    /* 1. Modifica el contenedor (quitamos el height fijo) */
    .img-grid-bottom {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
        width: 100%;
        /* Quitamos el height aqu√≠ para que no cause conflictos */
        height: auto; 
    }

    .img-grid-bottom img {
        height: 220px !important; 
        width: 100%;
        object-fit: cover;
        border-radius: 20px; /* Aseguramos que mantengan el borde */
    }

    /* --- TARJETA 2: PLAN MENSUAL --- */
    .plan-card {
        padding: 0;
    }

    .plan-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 30px 40px;
        gap: 20px;
        border-bottom: 1px solid #eee;
    }

    .plan-title h2 {
        font-family: var(--fuente-titulos);
        margin: 0;
        font-size: 1.8rem;
        line-height: 1;
        text-transform: uppercase;
    }

    .plan-desc {
        flex: 1;
        font-size: 0.9rem;
        line-height: 1.4;
        color: #444;
    }

    .plan-price-tag {
        background-color: var(--color-azul-claro);
        color: white;
        padding: 8px 20px;
        border-radius: 50px;
        font-weight: bold;
        font-size: 1.1rem;
        white-space: nowrap;
    }

    .plan-features {
        padding: 30px 40px;
    }

    .feature-row {
        display: grid;
        grid-template-columns: 1.5fr 3fr; 
        gap: 20px;
        padding: 15px 0;
    }

    .feature-name {
        display: flex;
        align-items: center;
        font-size: 0.95rem;
        color: #000;
    }

    .feature-text {
        font-size: 0.9rem;
        color: #555;
    }

    hr {
        border: 0;
        border-top: 1px solid #e0e0e0;
        margin: 0;
    }

    /* --- RESPONSIVE (M√ìVIL) --- */
    @media (max-width: 900px) { /* Cambi√© el breakpoint a 900px para tablets */
        .product-card {
            grid-template-columns: 1fr; /* Una sola columna */
            gap: 30px;
        }
        
        /* En m√≥vil, las im√°genes van primero o despu√©s? Normalmente despu√©s */
        .product-gallery {
            order: -1; /* Si quieres que las fotos salgan arriba, usa -1. Si no, quita esto */
        }

        .img-main {
            height: 250px;
        }
        
        .img-grid-bottom {
            height: 180px;
        }

        .plan-header {
            flex-direction: column;
            text-align: center;
            padding: 20px;
        }

        .feature-row {
            grid-template-columns: 1fr;
            gap: 5px;
        }
        
        .feature-name {
            margin-bottom: 5px;
            font-weight: bold;
        }
    }

    /* --- ESTILOS DEL MODAL DE CHECKOUT --- */
.modal-overlay {
    position: fixed;
    top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(4, 19, 62, 0.85); /* Fondo azul oscuro semitransparente */
    backdrop-filter: blur(5px); /* Efecto borroso moderno */
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 9999;
    opacity: 1;
    transition: opacity 0.3s ease;
}

.modal-overlay.hidden {
    opacity: 0;
    pointer-events: none; /* No se puede hacer clic si est√° oculto */
}

.modal-content {
    background: white;
    padding: 40px;
    border-radius: 20px;
    width: 90%;
    max-width: 450px;
    position: relative;
    box-shadow: 0 20px 50px rgba(0,0,0,0.5);
    text-align: center;
}

.close-btn {
    position: absolute;
    top: 15px; right: 20px;
    background: none; border: none;
    font-size: 2rem; cursor: pointer;
    color: #666;
}

.modal-header h3 {
    font-family: var(--fuente-titulos);
    color: var(--color-azul-fondo);
    font-size: 1.8rem;
    margin-bottom: 5px;
}

.order-summary {
    background: #f4f6f9;
    padding: 20px;
    border-radius: 10px;
    margin: 20px 0;
    text-align: left;
}

.summary-row {
    display: flex;
    justify-content: space-between;
    margin-bottom: 10px;
    color: #555;
}

.summary-row.total {
    border-top: 1px solid #ddd;
    padding-top: 10px;
    color: var(--color-azul-fondo);
    font-size: 1.2rem;
}

/* Formulario */
.checkout-form {
    display: flex;
    flex-direction: column;
    gap: 15px;
    text-align: left;
}

.checkout-form label {
    font-weight: bold;
    font-size: 0.9rem;
    color: #333;
}

.checkout-form input {
    padding: 12px;
    border: 1px solid #ccc;
    border-radius: 8px;
    font-family: var(--fuente-cuerpo);
    font-size: 1rem;
}

.btn-confirm {
    background-color: #25D366; /* Color WhatsApp */
    color: white;
    border: none;
    padding: 15px;
    border-radius: 50px;
    font-weight: bold;
    font-size: 1rem;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-top: 10px;
    transition: transform 0.2s;
}

.btn-confirm:hover {
    transform: scale(1.02);
    background-color: #1ebc57;
}

.secure-note {
    font-size: 0.75rem;
    color: #999;
    margin-top: 20px;
}
</style>