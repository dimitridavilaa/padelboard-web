---
// src/components/CompraDetalle.astro
---

<section class="compra-section">
    <div class="container">
        
        <div class="card product-card fade-up">
            
            <div class="product-info">
                <div class="pricing-toggle-wrapper">
                    <button class="toggle-btn active" id="mode-buy">
                        COMPRAR EQUIPO
                    </button>
                    <button class="toggle-btn" id="mode-rent">
                        ALQUILAR
                    </button>
                </div>

                <h1 id="product-title">MARCADOR PADELBOARD</h1>
                
                <p class="description" id="main-desc">
                    <strong>Lleva tu club al siguiente nivel.</strong> Con PadelBoard adquieres un activo que valoriza tus canchas, moderniza tus instalaciones y ofrece una experiencia profesional que fideliza a tus clientes.<br>Obtienes:
                </p>

                <ul class="feature-list">
                    <li><span class="bullet"></span> Pantalla HD 42‚Äù</li>
                    <li><span class="bullet"></span> 2 Sensores PadelBoard con pedestal</li>
                    <li><span class="bullet"></span> Soporte universal de pantalla</li>
                    <li><span class="bullet"></span> Kit de montaje / sistema al√°mbrico</li>
                </ul>

                <p class="disclaimer" id="disclaimer-text"></p>

                <div class="price-block">
                    <span class="price" id="price-display">$1,190.00 USD</span>
                    <span class="tax" id="price-label"> NO INCLUYE IVA</span>
                </div>

                <div class="actions-row">
                    <div class="qty-selector">
                        <button id="btn-minus" type="button">-</button>
                        <input type="number" id="qty-input" value="1" min="1" max="99" />
                        <button id="btn-plus" type="button">+</button>
                    </div>
                    
                    <button class="btn btn-primary" id="btn-add">AGREGAR AL CARRITO</button>
                </div>
                
                <button class="btn btn-full-width" id="btn-pay">PAGAR AHORA</button>
            </div>

            <div class="product-gallery">
                <div class="img-main">
                    <img src="/img/formulario.jpg" alt="Pantalla Padel Board" />
                </div>
                <div class="img-grid-bottom">
                    <img src="/img/sensor.jpg" alt="Sensor detalle frontal" />
                    <img src="/img/sensor2.jpg" alt="Sensor detalle trasero" />
                </div>
            </div>
        </div>

        <div class="card plan-card fade-up">
            
            <div class="plan-header">
                <div class="plan-title">
                    <h2 id="plan-title">PLAN MENSUAL <br>PADELBOARD</h2>
                </div>
                <div class="plan-desc">
                    El Plan Mensual PadelBoard es un servicio requerido que asegura el funcionamiento √≥ptimo de tu marcador inteligente y mantiene activa la garant√≠a del equipo. Este plan garantiza que tu PadelBoard opere siempre con la mejor experiencia, estabilidad y personalizaci√≥n posible.
                </div>
                <div class="plan-price-tag" id="plan-price-display">$25.00 USD<small>(por mes)</small></div> 
            </div>

            <div class="plan-features">
                <div class="feature-row">
                    <div class="feature-name">
                        <span class="bullet"></span> 
                        <strong>Mantenimiento del sistema y garant√≠a activa</strong>
                    </div>
                    <div class="feature-text">
                        Revisi√≥n continua del funcionamiento interno, prevenci√≥n de fallas y optimizaci√≥n del rendimiento del marcador. La garant√≠a del hardware se mantiene vigente mientras el plan est√© activo, asegurando respaldo ante cualquier inconveniente t√©cnico.
                    </div>
                </div>
                <hr>
                <div class="feature-row">
                    <div class="feature-name">
                        <span class="bullet"></span> 
                        <strong>Acceso completo a la App Web</strong>
                    </div>
                    <div class="feature-text">
                        Configura tus partidos escaneando el c√≥digo QR: nombres de jugadores, tipo de partido, punto de oro o ventaja, cambio de lado, entre otras opciones avanzadas.
                    </div>
                </div>
                <hr>
                <div class="feature-row">
                    <div class="feature-name">
                        <span class="bullet"></span> 
                        <strong>Actualizaciones constantes y Soporte t√©cnico en l√≠nea</strong>
                    </div>
                    <div class="feature-text">
                        Mejoras peri√≥dicas en el sistema, nuevas funciones, mayor estabilidad y experiencia de uso actualizada. Atenci√≥n remota r√°pida para resolver dudas, problemas o asistencia en configuraci√≥n.
                    </div>
                </div>
                 <hr>
                <div class="feature-row">
                    <div class="feature-name">
                        <span class="bullet"></span> 
                        <strong>Eliminaci√≥n de publicidad y Personalizaci√≥n del marcador</strong>
                    </div>
                    <div class="feature-text">
                        Tu marcador funcionar√° sin anuncios, ofreciendo una experiencia m√°s profesional y limpia. Configuraci√≥n con el nombre y los colores oficiales de tu club, reforzando la identidad visual y profesionalizaci√≥n del espacio deportivo.
                    </div>
                </div>
            </div>

        </div>

    </div>

    <div id="checkout-modal" class="modal-overlay hidden">
        <div class="modal-content fade-up">
            <button id="close-modal" class="close-btn">&times;</button>
            
            <div class="modal-header">
                <h3>RESUMEN DE TU PEDIDO</h3>
                <p>Confirma los detalles antes de contactar a un asesor.</p>
            </div>
    
            <div class="order-summary">
                <div class="summary-row">
                    <span>Producto:</span>
                    <strong>Marcador PadelBoard</strong>
                </div>
                <div class="summary-row">
                    <span>Cantidad:</span>
                    <strong id="modal-qty">1</strong>
                </div>
                <div class="summary-row total">
                    <span>Total Estimado:</span>
                    <strong id="modal-total">$1,190.00 USD</strong>
                </div>
            </div>
    
            <form id="checkout-form" class="checkout-form">
                <label>Tu Nombre Completo</label>
                <input type="text" id="client-name" placeholder="Ej. Juan P√©rez" required>
                
                <label>Nombre de tu Club / Empresa</label>
                <input type="text" id="client-company" placeholder="Ej. Padel Center" required>
    
                <button type="submit" class="btn-confirm">
                    CONFIRMAR Y SOLICITAR EN WHATSAPP
                    <img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg" width="20" style="margin-left:8px">
                </button>
            </form>
            
            <p class="secure-note">üîí Tus datos se enviar√°n encriptados al chat de ventas.</p>
        </div>
    </div>

</section>

<script>
    import { addToCart } from '../store/cart.js';

    // --- CONFIGURACI√ìN DE PRECIOS ---
    const WHATSAPP_NUMBER = "593987225485";
    
    // MODO COMPRA
    const BUY_PRICE = 1190;
    //const BUY_PRICE_DISCOUNT = 899; // Si compra 3+
    const BUY_PLAN_PRICE = 25;      // Mensualidad software
    
    // MODO ALQUILER
    const RENT_INIT_FEE = 150;      // Precio Instalaci√≥n
    const RENT_MONTHLY = 99;        // Cuota mensual total
    
    // ESTADO
    let currentMode = 'buy'; 

    // ELEMENTOS DOM (Casting para TypeScript)
    const minusBtn = document.getElementById('btn-minus');
    const plusBtn = document.getElementById('btn-plus');
    const input = document.getElementById('qty-input') as HTMLInputElement; 
    
    // Elementos de texto
    const priceDisplay = document.getElementById('price-display');
    const priceLabel = document.getElementById('price-label');
    const mainDesc = document.getElementById('main-desc');
    const planTitle = document.getElementById('plan-title');
    const planPriceDisplay = document.getElementById('plan-price-display');
    
    // Botones Toggle
    const btnModeBuy = document.getElementById('mode-buy');
    const btnModeRent = document.getElementById('mode-rent');

    // Botones Acci√≥n
    const btnPay = document.getElementById('btn-pay');
    const btnAdd = document.getElementById('btn-add'); // <--- AHORA S√ç LO USAREMOS

    // Modal
    const modal = document.getElementById('checkout-modal');
    const closeModal = document.getElementById('close-modal');
    const modalQty = document.getElementById('modal-qty');
    const modalTotal = document.getElementById('modal-total');
    const checkoutForm = document.getElementById('checkout-form');
    const clientName = document.getElementById('client-name') as HTMLInputElement;
    const clientCompany = document.getElementById('client-company') as HTMLInputElement;


    // --- L√ìGICA DE CAMBIO DE MODO ---
    function setMode(mode: string) {
        currentMode = mode;
        const disclaimerText = document.getElementById('disclaimer-text');
        
        if (btnModeBuy && btnModeRent && mainDesc && priceLabel && planTitle && disclaimerText && input) {
            
            // SIEMPRE permitimos comprar desde 1 unidad (en ambos modos)
            input.min = "1";

            if(mode === 'buy') {
                // --- MODO COMPRA ---
                btnModeBuy.classList.add('active');
                btnModeRent.classList.remove('active');
                
                mainDesc.innerHTML = `<strong>Lleva tu club al siguiente nivel.</strong> Con PadelBoard adquieres un activo que valoriza tus canchas, moderniza tus instalaciones y ofrece una experiencia profesional que fideliza a tus clientes. Obtienes:`;
                
                // Sin texto de descuento
                disclaimerText.innerHTML = ""; 
                
                priceLabel.innerText = "NO INCLUYE IVA";
                planTitle.innerHTML = "PLAN MENSUAL <br>PADELBOARD";
                
            } else {
                // --- MODO ALQUILER ---
                btnModeRent.classList.add('active');
                btnModeBuy.classList.remove('active');
                
                mainDesc.innerHTML = `<strong>Moderniza tu club sin descapitalizarte.</strong> Con el modelo de Alquiler equipas tus canchas con tecnolog√≠a de punta mediante una suscripci√≥n mensual flexible, manteniendo tu liquidez y garantizando soporte total. Obtienes:`;
                
                // Sin texto de restricci√≥n (ya no exigimos 3)
                disclaimerText.innerHTML = "";
                
                priceLabel.innerText = "NO INCLUYE IVA";
                planTitle.innerHTML = "PLAN MENSUAL <br>PADELBOARD";
            }
        }
        updateCalculations();
    }

    // --- C√ÅLCULOS ---
    function updateCalculations() {
        let qty = parseInt(input?.value) || 1;
        
        if (priceDisplay && planPriceDisplay) {
            if (currentMode === 'buy') {
                // --- MODO COMPRA ---
                let unitPrice = BUY_PRICE;
                priceDisplay.innerText = `$${unitPrice.toLocaleString('en-US', {minimumFractionDigits: 2})} USD`; 
                planPriceDisplay.innerHTML = `$${BUY_PLAN_PRICE}.00 USD<small>(por mes)</small>`;
                planPriceDisplay.style.color = "var(--color-amarillo)";

            } else {
                // --- MODO ALQUILER ---
                priceDisplay.innerHTML = `$${RENT_MONTHLY}.00 USD<small> /MES</small>`;
                planPriceDisplay.innerText = "INCLUIDO";
                planPriceDisplay.style.color = "#4ade80"; 
            }
        }
    }

    // --- MODAL Y WHATSAPP ---
    function openModal(e: Event) {
        e.preventDefault();
        let qty = parseInt(input?.value) || 1;
        let totalDisplay = "";
        
        if(currentMode === 'buy') {
            let unitPrice = BUY_PRICE;
            let total = unitPrice * qty;
            totalDisplay = `$${total}.00 USD (Pago √önico)`;
        } else {
            // MODO ALQUILER
            // Mostramos el total a pagar hoy (Instalaci√≥n + 1er mes o solo Instalaci√≥n, como t√∫ prefieras cobrar)
            let totalInit = RENT_INIT_FEE * qty;
            totalDisplay = `$${totalInit}.00 USD (Instalaci√≥n) + Mes 1`;
        }

        if(modalQty) modalQty.innerText = qty.toString();
        if(modalTotal) modalTotal.innerText = totalDisplay;
        
        if(modal) modal.classList.remove('hidden');
    }

    function sendToWhatsapp(e: Event) {
        e.preventDefault();
        let qty = parseInt(input?.value) || 1;
        const name = clientName ? clientName.value : "";
        const company = clientCompany ? clientCompany.value : "";

        if(!name || !company) {
            alert("Por favor completa tu nombre y empresa");
            return;
        }

        let message = "";

        if (currentMode === 'buy') {
            let unitPrice = BUY_PRICE;
            let total = unitPrice * qty;
            
            message = `*NUEVO PEDIDO DE COMPRA* üõí\n` +
                      `üë§ Cliente: ${name}\nüè¢ Club: ${company}\n` +
                      `--------------------------------\n` +
                      `üî¢ Cantidad: ${qty} Marcadores\n` +
                      `üí≤ Precio Unitario: $${unitPrice}\n` +
                      `üí∞ *TOTAL EQUIPOS: $${total} USD*\n` +
                      `üìÖ Plan Software: $${BUY_PLAN_PRICE}/mes por equipo`;
        } else {
            let totalInit = RENT_INIT_FEE * qty;
            let totalMonthly = RENT_MONTHLY * qty;

            message = `*SOLICITUD DE ALQUILER* üîÑ\n` +
                      `üë§ Cliente: ${name}\nüè¢ Club: ${company}\n` +
                      `--------------------------------\n` +
                      `üî¢ Cantidad: ${qty} Marcadores\n` +
                      `üíµ Inscripci√≥n Total: $${totalInit} USD\n` +
                      `üìÖ *Cuota Mensual Total: $${totalMonthly} USD*\n` +
                      `(Incluye Equipo + Software)`;
        }

        let encoded = encodeURIComponent(message);
        window.open(`https://wa.me/${WHATSAPP_NUMBER}?text=${encoded}`, '_blank');
        if(modal) modal.classList.add('hidden');
    }

    // --- LISTENERS ---
    if(minusBtn && plusBtn && input) {
        
        plusBtn.addEventListener('click', () => {
            input.value = ((parseInt(input.value) || 0) + 1).toString();
            updateCalculations();
        });

        minusBtn.addEventListener('click', () => {
            let val = parseInt(input.value) || 0;
            // SIEMPRE el l√≠mite es 1, ya no depende del modo
            let minLimit = 1; 

            if (val > minLimit) {
                input.value = (val - 1).toString();
                updateCalculations();
            }
        });

        input.addEventListener('change', () => {
            let val = parseInt(input.value) || 0;
            // SIEMPRE el l√≠mite es 1
            if(val < 1) input.value = "1";
            updateCalculations();
        });
    }

    if(btnModeBuy) btnModeBuy.addEventListener('click', () => setMode('buy'));
    if(btnModeRent) btnModeRent.addEventListener('click', () => setMode('rent'));

    if (btnPay) btnPay.addEventListener('click', openModal);
    if (closeModal && modal) closeModal.addEventListener('click', () => modal.classList.add('hidden'));
    if (checkoutForm) checkoutForm.addEventListener('submit', sendToWhatsapp);
    if (modal) modal.addEventListener('click', (e) => { if(e.target === modal) modal.classList.add('hidden'); });

    // SOLUCI√ìN AL IMPORT GRIS: Usamos addToCart aqu√≠
    if (btnAdd) {
        btnAdd.addEventListener('click', (e) => {
            e.preventDefault();
            const qty = parseInt(input?.value) || 1;
            
            // Calculamos precio seg√∫n modo
            let finalPrice = 0;
            let productName = "";

            if (currentMode === 'buy') {
                finalPrice = BUY_PRICE;
                productName = "Marcador PadelBoard (Compra)";
            } else {
                finalPrice = RENT_INIT_FEE;
                productName = "Marcador PadelBoard (Alquiler)";
            }

            addToCart({
                id: currentMode === 'buy' ? 'marcador-padelboard' : 'renting-padelboard',
                name: productName,
                price: finalPrice,
                quantity: qty,
                image: '/img/formulario.jpg'
            });
        });
    }

    // Inicializar
    setMode('buy');
</script>

<style>
    /* --- ESTRUCTURA PRINCIPAL --- */
    .compra-section {
        padding: 40px 20px;
        background: var(--gradiente-padel);
        font-family: var(--fuente-cuerpo);
    }

    .container {
        max-width: 1100px;
        margin: 0 auto;
    }

    .card {
        background-color: rgba(12, 18, 35, 0.55); /* Azul muy transparente */
        backdrop-filter: blur(3px); /* Efecto borroso detr√°s */
        -webkit-backdrop-filter: blur(3px); /* Soporte para Safari */
        border-radius: 30px;
        padding: 40px;
        margin-bottom: 30px;
        color: white;
        /* SOLUCI√ìN 1: Esto evita que nada se salga de los bordes redondeados */
        overflow: hidden; 
        box-shadow: 0 10px 30px rgba(0,0,0,0.1); /* Un poco de sombra para profundidad */
    }

    /* --- TARJETA 1: PRODUCTO --- */
    .product-card {
        display: grid;
        /* SOLUCI√ìN 2: Ajustamos las proporciones. 
           1.2fr para texto (m√°s espacio) y 0.8fr para fotos (m√°s controlado) */
        grid-template-columns: 1.2fr 0.8fr; 
        gap: 40px;
        align-items: start; /* Alinea al inicio para que no se estire raro */
    }

    .product-info {
        /* Evita que el texto empuje el ancho m√°s de lo debido */
        min-width: 0; 
    }

    h1 {
        font-family: var(--fuente-titulos);
        font-size: 2.2rem; /* Ajustado levemente para que quepa mejor */
        margin-top: 0;
        margin-bottom: 20px;
        text-transform: uppercase;
        line-height: 1;
        color: var(--color-amarillo)
    }

    .description {
        font-size: 0.95rem;
        line-height: 1.5;
        margin-bottom: 20px;
        color: white;
    }

    /* Lista con iconos amarillos */
    .feature-list {
        list-style: none;
        padding: 0;
        margin-bottom: 20px;
    }

    .feature-list li {
        display: flex;
        align-items: center;
        margin-bottom: 10px;
        font-weight: 700;
        font-size: 0.9rem;
    }

    .bullet {
    display: inline-block;
    width: 11px; 
    height: 11px;
    
    /* Usamos la imagen como fondo */
    background-image: url('/img/pelota-padelboard.png'); 
    
    /* Asegura que la pelotita entera quepa dentro del espacio */
    background-size: contain; 
    background-repeat: no-repeat;
    background-position: center;

    margin-right: 10px;
    flex-shrink: 0;
    }

    .disclaimer {
        font-size: 0.75rem;
        font-style: italic;
        color: #c2c2c2;
        margin-bottom: 20px;
    }

    .price-block {
        margin-bottom: 20px;
    }
    .price {
        display: block;
        font-size: 2.2rem;
        font-weight: 700;
        font-family: var(--fuente-titulos);
    }
    .tax {
        font-size: 0.8rem;
        color: #c2c2c2;
        font-weight: bold;
    }

    /* Botones y Selectores */
    .actions-row {
        display: flex;
        gap: 10px;
        margin-bottom: 15px;
        flex-wrap: wrap; /* Permite que bajen si no caben */
    }

    /* 1. Selector de Cantidad (La pastilla peque√±a) */
    .qty-selector {
        display: flex;
        align-items: center;
        background-color: var(--color-azul-claro);
        border-radius: 50px;
        padding: 0px 10px; 
        color: white;
        font-weight: bold;
        
        /* CAMBIO: Reducimos ancho m√≠nimo */
        min-width: 110px; 
        
        justify-content: space-between;
        
        /* Opcional: Altura fija para alinearlo perfecto con el bot√≥n de al lado */
        height: 42px; 
    }
    
    /* 2. El n√∫mero dentro del selector */
    #qty-input {
        background: transparent;
        border: none;
        color: white;
        font-family: var(--fuente-titulos);
        font-size: 1.2rem; 
        text-align: center;
        width: 45px;
        outline: none;
    }

    /* Truco CSS para quitar las flechas de n√∫mero nativas del navegador */
    /* Chrome, Safari, Edge, Opera */
    input::-webkit-outer-spin-button,
    input::-webkit-inner-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }
    /* Firefox */
    input[type=number] {
      -moz-appearance: textfield;
    }

    /* 3. Botones + y - */
    .qty-selector button {
        background: none;
        border: none;
        color: white;
        font-size: 1.2rem; 
        cursor: pointer;
        padding: 0 5px;
        transition: transform 0.2s;
        display: flex;       /* Ayuda a centrar el s√≠mbolo verticalmente */
        align-items: center; /* Centrado vertical */
    }
    
    .qty-selector button:hover {
        transform: scale(1.2); /* Efecto al pasar mouse por +/- */
    }

    /* 4. Botones de Acci√≥n (Agregar al Carrito / Pagar Ahora) */
    .btn {
        border: none;
        /* CAMBIO: Reducimos el padding vertical (antes 12px) */
        padding: 0 25px; 
        border-radius: 50px;
        cursor: pointer;
        font-family: var(--fuente-titulos);
        font-size: 1.1rem; 
        letter-spacing: 1.5px;
        transition: transform 0.2s, background-color 0.2s;
        text-transform: uppercase;
        height: 42px; 
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .btn:hover {
        transform: scale(1.02);
        opacity: 0.9;
    }

    .btn-primary {
        background-color: var(--color-azul-claro);
        color: white;
        flex-grow: 1;
        text-align: center;
    }

    .btn-full-width {
        width: 100%;
        background-color: var(--color-azul-claro);
        color: white;
    }

    /* --- GALER√çA DE IM√ÅGENES (FIX CR√çTICO) --- */
    .product-gallery {
        display: flex;
        flex-direction: column;
        gap: 15px;
        /* SOLUCI√ìN 4: Forzamos a que este contenedor nunca sea m√°s ancho que su columna */
        width: 100%;
        min-width: 0; 
    }

    .product-gallery img {
        width: 100%;
        height: 100%;
        object-fit: cover; /* Esto recorta la imagen para llenar el espacio sin deformar */
        border-radius: 20px;
        display: block;
    }

    .img-main {
        /* Altura fija para la imagen grande */
        height: 380px; 
        width: 100%;
    }

    /* 1. Modifica el contenedor (quitamos el height fijo) */
    .img-grid-bottom {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
        width: 100%;
        /* Quitamos el height aqu√≠ para que no cause conflictos */
        height: auto; 
    }

    .img-grid-bottom img {
        height: 183px !important; 
        width: 100%;
        object-fit: cover;
        border-radius: 20px; /* Aseguramos que mantengan el borde */
    }

    /* --- TARJETA 2: PLAN MENSUAL --- */
    .plan-card {
        padding: 0;
    }

    .plan-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 30px 40px;
        gap: 20px;
        border-bottom: 1px solid #eee;
    }

    .plan-title h2 {
        font-family: var(--fuente-titulos);
        color: var(--color-amarillo);
        margin: 0;
        font-size: 1.8rem;
        line-height: 1;
        text-transform: uppercase;
    }

    .plan-desc {
        flex: 1;
        font-size: 0.9rem;
        line-height: 1.4;
        color: white;
    }

    .plan-price-tag {
        background-color: transparent;
        color: var(--color-amarillo);
        text-shadow:  0 4px 10px rgba(0,0,0,0.3);
        padding: 6px 5px;
        font-weight: 800;
        font-size: 2rem;
        
        /* --- CAMBIOS PARA APILAR TEXTO --- */
        display: inline-flex;     /* Usamos flex para controlar la direcci√≥n */
        flex-direction: column;   /* Pone uno encima del otro */
        align-items: center;      /* Centra los textos */
        line-height: 1;           /* Reduce espacio entre el precio y el mes */
        white-space: normal;      /* Permitimos salto de l√≠nea */
        margin-top: 5px;
    }

    /* Esto har√° que la parte de "/Mes" se vea m√°s peque√±a autom√°ticamente */
    .plan-price-tag small {
        font-size: 0.5em; /* 50% del tama√±o del precio */
        opacity: 0.9;
        font-weight: 900;
        margin-top: 5px;
    }

    .plan-features {
        padding: 30px 40px;
    }

    .feature-row {
        display: grid;
        grid-template-columns: 1.5fr 3fr; 
        gap: 20px;
        padding: 15px 0;
    }

    .feature-name {
        display: flex;
        align-items: center;
        font-size: 0.95rem;
        color: white;
    }

    .feature-text {
        font-size: 0.9rem;
        color: whitesmoke;
    }

    hr {
        border: 0;
        border-top: 1px solid #e0e0e0;
        margin: 0;
    }

    /* --- ESTILOS DEL MODAL DE CHECKOUT --- */
.modal-overlay {
    position: fixed;
    top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(4, 19, 62, 0.85); /* Fondo azul oscuro semitransparente */
    backdrop-filter: blur(5px); /* Efecto borroso moderno */
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 9999;
    opacity: 1;
    transition: opacity 0.3s ease;
}

.modal-overlay.hidden {
    opacity: 0;
    pointer-events: none; /* No se puede hacer clic si est√° oculto */
}

.modal-content {
    background: white;
    padding: 40px;
    border-radius: 20px;
    width: 90%;
    max-width: 450px;
    position: relative;
    box-shadow: 0 20px 50px rgba(0,0,0,0.5);
    text-align: center;
}

.close-btn {
    position: absolute;
    top: 15px; right: 20px;
    background: none; border: none;
    font-size: 2rem; cursor: pointer;
    color: #666;
}

.modal-header h3 {
    font-family: var(--fuente-titulos);
    color: var(--color-azul-fondo);
    font-size: 1.8rem;
    margin-bottom: 5px;
}

.order-summary {
    background: #f4f6f9;
    padding: 20px;
    border-radius: 10px;
    margin: 20px 0;
    text-align: left;
}

.summary-row {
    display: flex;
    justify-content: space-between;
    margin-bottom: 10px;
    color: #555;
}

.summary-row.total {
    border-top: 1px solid #ddd;
    padding-top: 10px;
    color: var(--color-azul-fondo);
    font-size: 1.2rem;
}

/* Formulario */
.checkout-form {
    display: flex;
    flex-direction: column;
    gap: 15px;
    text-align: left;
}

.checkout-form label {
    font-weight: bold;
    font-size: 0.9rem;
    color: #333;
}

.checkout-form input {
    padding: 12px;
    border: 1px solid #ccc;
    border-radius: 8px;
    font-family: var(--fuente-cuerpo);
    font-size: 1rem;
}

.btn-confirm {
    background-color: #25D366; /* Color WhatsApp */
    color: white;
    border: none;
    padding: 15px;
    border-radius: 50px;
    font-weight: bold;
    font-size: 1rem;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-top: 10px;
    transition: transform 0.2s;
}

.btn-confirm:hover {
    transform: scale(1.02);
    background-color: #1ebc57;
}

.secure-note {
    font-size: 0.75rem;
    color: #999;
    margin-top: 20px;
}

/* --- ESTILOS DEL TOGGLE --- */
.pricing-toggle-wrapper {
        display: flex;
        background-color: rgba(255,255,255,0.1);
        border-radius: 50px;
        padding: 5px;
        margin-bottom: 25px;
        width: fit-content;
        border: 1px solid rgba(255,255,255,0.2);
    }

    .toggle-btn {
        background: transparent;
        border: none;
        color: white;
        padding: 10px 25px;
        border-radius: 40px;
        cursor: pointer;
        font-family: var(--fuente-titulos);
        font-size: 1rem;
        letter-spacing: 1px;
        transition: all 0.3s ease;
    }

    .toggle-btn.active {
        background-color: var(--color-amarillo);
        color: black;
        box-shadow: 0 4px 15px rgba(255, 222, 89, 0.4);
    }

/* --- RESPONSIVE M√ìVIL (MODO APP NATIVA) --- */
@media (max-width: 900px) {
        /* SOLUCI√ìN ZOOM: Desactiva el zoom al tocar r√°pido botones */
        button, .btn, .qty-selector button, input {
            touch-action: manipulation; 
        }
        
        /* 1. Ajustes Generales de Espacio */
        .compra-section {
            padding: 20px 5px; /* Menos relleno lateral para ganar espacio */
        }
        
        .card {
            padding: 25px 20px; /* Tarjetas m√°s compactas */
            border-radius: 20px;
        }

        /* 2. Tarjeta de Producto (Vertical) */
        .product-card {
            grid-template-columns: 1fr; /* Una sola columna */
            gap: 25px;
        }
        
        /* Ponemos las im√°genes arriba */
        .product-gallery {
            order: -1; 
        }

        /* Imagen principal m√°s apaisada para que no empuje todo el contenido abajo */
        .img-main {
            height: 200px; 
        }
        
        /* Ocultamos las miniaturas en m√≥vil para limpiar la vista y enfocar en la venta */
        .img-grid-bottom {
            display: none; 
        }

        /* 3. Tipograf√≠a Ajustada */
        h1 {
            font-size: 1.8rem; /* T√≠tulo m√°s f√°cil de leer */
            margin-bottom: 10px;
        }
        
        .description {
            font-size: 0.9rem;
            line-height: 1.4;
        }

        .price {
            font-size: 2.2rem; /* Precio grande y claro */
        }

        /* 4. BOTONES Y ACCIONES (LO M√ÅS IMPORTANTE) */
        .actions-row {
            flex-direction: column; /* Apilamos verticalmente */
            gap: 15px;
            width: 100%;
        }

        /* Selector de Cantidad: Grande y centrado */
        .qty-selector {
            width: 100%; 
            justify-content: space-between;
            padding: 0 30px; /* Buen espacio para los dedos */
            height: 55px; /* Altura c√≥moda para tocar */
            box-sizing: border-box;
            font-size: 1.3rem; /* N√∫meros m√°s grandes */
        }
        
        /* Botones de Acci√≥n: Ancho completo estilo App */
        .btn {
            width: 100%;
            height: 55px; /* Misma altura que el selector */
            font-size: 1rem;
            margin: 0;
        }

        /* 5. Tarjeta del Plan Mensual */
        .plan-header {
            flex-direction: column;
            padding: 20px 5px;
            gap: 15px;
        }

        .plan-features {
        padding: 20px 5px;
    }
        
        .plan-title h2 {
            font-size: 2rem;
            text-align: center;
        }

        .plan-desc {
            text-align: justify;
        }

        .feature-row {
            grid-template-columns: 1fr; /* Texto debajo del t√≠tulo */
            gap: 8px;
            text-align: left;
        }
        
        .feature-name {
            margin-bottom: 0;
            font-size: 1rem;
        }
    }
</style>